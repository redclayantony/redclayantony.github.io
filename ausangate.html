<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
	<title>Ausangate</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link href='https://api.mapbox.com/mapbox.js/v2.4.0/mapbox.css' rel='stylesheet' />
	<link href="css/bootstrap.min.css" rel="stylesheet">
	<link href="css/custom.css" rel="stylesheet">
    <link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet' />
	<script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
</head>

<body>
  <header>
   <nav class="navbar navbar-inverse role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    
                </button>
                <a class="navbar-brand" href=#>Kay Pacha</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <div class="dropdown">
                          <button class="dropbtn">Treks</button>
                          <div class="dropdown-content">
                            <a href=#>Ausangate</a>
                            <a href="incatrail.html">Machu Picchu</a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- /.container -->
    </nav>
  </header>
<div id='map'></div>
    <script>
    L.mapbox.accessToken = 'pk.eyJ1IjoicnVzc2x5b244IiwiYSI6IjBSaDVoeW8ifQ.UMzpeudvSJ3dHxAtKiakFg';
    var map = L.mapbox.map('map', null, {
        maxZoom:18}).setView([-9.3651, -73.73], 5);
    var layers = {
        Streets: L.mapbox.tileLayer('mapbox.streets'),
        Outdoors: L.mapbox.styleLayer('mapbox://styles/russlyon8/ciwjh10yq000d2qo73t44eva0'),
        Satellite: L.mapbox.styleLayer('mapbox://styles/russlyon8/cioowi3rs001rbnnnsmkskehw')
    };

    layers.Outdoors.addTo(map);
    L.control.layers(layers).addTo(map);
    
    // Set CartoDB Username
    var cartoUserName = "redclayantony";
    
    var ausangateLayer = null;

    //event listener for mouseover   
        function highlightFeature(e) {
            var layer = e.target;

                layer.setStyle({
                    weight: 8,
                    color: '#7D26CD',
                    dashArray: ''
                });

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
            info.update(layer.feature.properties);
            }

        function resetHighlight(e) {
            ausangateLayer.resetStyle(e.target);
            info.update();
        }

        //click listern zooms to feature
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        // sql query on ausangateLayer
        var sqlQueryAusangate = "SELECT * FROM ausangateTrek";

        //machuTrek line style
        var ausangateStyle = {
            color: "#aa6e8e",
            weight: 3,
            opacity: 1,
            dashArray: "5"
        };

        // remove treksMachu if preloaded
        function showAll(){
        if(map.hasLayer(ausangateTrek)){
            map.removeLayer(ausangateTrek);
            }
        }
        // add listeners to treksmachu
        function onEachFeature(feature, layer){
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }
        
    // Function to add ausangateLayer
	$.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryAusangate, function(data) {
        ausangateLayer = L.geoJson(data,{
		    style: ausangateStyle,
            onEachFeature: onEachFeature
            }).addTo(map);
        map.fitBounds(ausangateLayer.getBounds());
        });
   
   // Add trailheadcusco.geojson
        var trailHead = null;
        
        // sql query on trailheads
        var sqlQueryTH = "SELECT * FROM trailheadscusco";

        // remove trailheads if already loaded
        function showAll(){
            if(map.hasLayer(trailheadscusco)){
                map.removeLayer(trailheadscusco);
            }}
  
       //archIcon
        var trailheadIcon = L.icon({
            iconUrl: 'icons/walker.svg',
            iconSize: [14,14],
            iconAnchor: [5,5],
            popupanchor: [0,-3]
        });

        // Get CartoDB selection as GEOJSON and Add to Map
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryTH, function(data) {
            trailHead = L.geoJson(data,{
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.name);
                }, pointToLayer: function (feature, latlng) {
                    var marker = L.marker(latlng,{icon: trailheadIcon});
                    return marker;
                }
            }).addTo(map);
        }); 

    var ausangatePOILayer = null;

    var sqlQueryAusPOI = "SELECT * FROM ausangatepoi";

    $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryAusPOI, function(data) {
        ausangatePOILayer = L.geoJson(data,{
	        onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.name);
            }, pointToLayer: function (feature, latlng) {
                var marker = L.marker(latlng,{icon: poiIcon});
                return marker;
               }
        }).addTo(map);
    });
    // marker Icon
    var poiIcon = L.icon({
	    iconUrl: 'icons/mountain.svg',
	    iconSize: [16,16],
	    iconAnchor: [18,18],
	    popupAnchor: [0,-6]
    });
				
    //Run showAll function when doc loads
    $( document ).ready(function() {
        showAll();
    });

 </script>
</body>
</html>