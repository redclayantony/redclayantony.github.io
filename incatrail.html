<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <title>Kay Pacha</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link href="css/bootstrap.min.css" rel="stylesheet"><!-- Bootstrap Core CSS -->
    <link href="css/custom.css" rel="stylesheet"><!-- Custom CSS -->
    <link href='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js'></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><!--Need this to make geojson load-->
</head>

<body>
 <div class="wrapper">
  <header>
   <nav class="navbar navbar-inverse role="navigation">
        <div class="container">
          <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    
                </button>
                <a class="navbar-brand" href=#>Kay Pacha</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <div class="dropdown">
                          <button class="dropbtn">Treks</button>
                          <div class="dropdown-content">
                            <a href="ausangate.html">Ausangate</a>
                            <a href="#">Machu Picchu</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
 </div>
<div id='map'></div>
    <script>
        L.mapbox.accessToken = 'pk.eyJ1IjoicnVzc2x5b244IiwiYSI6IjBSaDVoeW8ifQ.UMzpeudvSJ3dHxAtKiakFg';
        var map = L.mapbox.map('map', null, {maxZoom:18}).setView([-13.163, -72.545], 15);
        var layers = {
            Streets: L.mapbox.tileLayer('mapbox.streets'),
            Outdoors: L.mapbox.styleLayer('mapbox://styles/russlyon8/ciwjh10yq000d2qo73t44eva0'),
            Satellite: L.mapbox.styleLayer('mapbox://styles/russlyon8/cioowi3rs001rbnnnsmkskehw')
        };

        layers.Outdoors.addTo(map);
        L.control.layers(layers).addTo(map);
        
        // Set CartoDB Username
        var cartoUserName = "redclayantony";
        
        // Add archaeologicalsites geojson from Carto
        var archSite = null;

        // sql query call on archaeological sites
        var sqlQueryArch = "SELECT * FROM archSiteMachu";

        // Set CartoDB Username
        var cartoUserName = "redclayantony";

        // remove archsites if already loaded
        function showAll(){
         if(map.hasLayer(archSiteMachu)){
           map.removeLayer(archSiteMachu);
        }}
  
         //archIcon style
        var archIcon = L.icon({
            iconUrl: 'icons/archIcon2.svg',
            iconSize: [28,28],
            iconAnchor: [5,5],
            popupanchor: [0,-3]
        });

        // Get CartoDB selection as GEOJSON and Add to Map
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryArch, function(data) {
            archSite = L.geoJson(data,{
                onEachFeature: function (feature, layer) {
                   layer.bindPopup(feature.properties.name);
                }, pointToLayer: function (feature, latlng) {
                    var marker = L.marker(latlng,{icon: archIcon});
                    return marker;
                }
            }).addTo(map);
        });

        // Add trailheadcusco.geojson
        var trailHead = null;
        
        // sql query on trailheads
        var sqlQueryTH = "SELECT * FROM trailheadscusco";

        // remove trailheads if already loaded
        function showAll(){
            if(map.hasLayer(trailheadscusco)){
                map.removeLayer(trailheadscusco);
            }}
  
       //archIcon
        var trailheadIcon = L.icon({
            iconUrl: 'icons/walker.svg',
            iconSize: [14,14],
            iconAnchor: [5,5],
            popupanchor: [0,-3]
        });

        // Get CartoDB selection as GEOJSON and Add to Map
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryTH, function(data) {
            trailHead = L.geoJson(data,{
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.name);
                }, pointToLayer: function (feature, latlng) {
                    var marker = L.marker(latlng,{icon: trailheadIcon});
                    return marker;
                }
            }).addTo(map);
        }); 
  
        // Add treksMachuGeo2.geojson
        var treksMachu = null;
            
        //event listener for mouseover   
        function highlightFeature(e) {
            var layer = e.target;

                layer.setStyle({
                    weight: 8,
                    color: '#7D26CD',
                    dashArray: ''
                });

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
            info.update(layer.feature.properties);
            }

        function resetHighlight(e) {
            treksMachu.resetStyle(e.target);
            info.update();
        }

        //click listern zooms to feature
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        // sql query on treksmachgeo2
        var sqlQueryInca = "SELECT * FROM treksmachugeo2";

        //machuTrek line style
        var trekStyle = {
            color: "#aa6e8e",
            weight: 3,
            opacity: 1,
            dashArray: "5"
        };

        // remove treksMachu if preloaded
        function showAll(){
            if(map.hasLayer(treksmachugeo2)){
                map.removeLayer(treksmachugeo2);
            }
        }
        // add listeners to treksmachu
        function onEachFeature(feature, layer){
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }
 
        // load treksmachu from carto and assign oneachfeature
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryInca, function(data) {
            treksMachu = L.geoJson(data,{
                style: trekStyle,
                onEachFeature: onEachFeature
            }).addTo(map);
        });

        // Add sanctuarymp.geojson
        var sanctMachu = null;

        // sql query for machupicchu santuary
        var sqlQueryMachu = "SELECT * FROM sanctuarymp";

        //sanctMP style
        var sanctStyle = {
            color: "#659D32",
            fill: false,
            weight: 7,
            opacity: 0.7,
            dashArray: "1"
        };

        // remove if preloaded
        function showAll(){
            if(map.hasLayer(sanctuarymp)){
                map.removeLayer(sanctuarymp);
            }
        }
        // Get CartoDB selection as GEOJSON and Add to Map
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryMachu, function(data) {
            sanctMachu = L.geoJson(data,{
                style: sanctStyle,
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.label);
                    layer.cartodb_id=feature.properties.cartodb_id;
                }
            }).addTo(map);
        });
 
        // Custom Control Box  
        var info = L.control();

        info.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
            this.update();
            return this._div;
        };

        // method that we will use to update the control based on feature properties passed
        info.update = function (props) {
            this._div.innerHTML = '<h4>Trek Details:</h4>' +  (props ?
                '<b>' + props.label + '</b><br /><br />' + props.length_mi + ' miles</sup>'
            : 'Hover over a trek');
        };

        info.addTo(map);
  
        //Run showAll function when doc loads
        $( document ).ready(function() {
            showAll();
        });

    </script>
</body>
</html>