<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>CuscoTrek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link href="css/bootstrap.min.css" rel="stylesheet"><!-- Bootstrap Core CSS -->
    <link href="css/custom.css" rel="stylesheet"><!-- Custom CSS -->
	<link href="css/leaflet-sidebar.css" rel="stylesheet"><!-- LeafletSidebarCSS -->
    <link href="https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.css" rel="stylesheet"/>
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox.js/v3.0.1/mapbox.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script><!--Need this to make geojson load-->
	<script src="js/leaflet-sidebar.js"></script>
</head>

<body>
<div id="header">Trek Cusco</div>
<div id="sidebar" class="sidebar collapsed">
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
                <li><a href="#profile" role="tab"><i class="fa fa-user"></i></a></li>
                <li class="disabled"><a href="#messages" role="tab"><i class="fa fa-envelope"></i></a></li>
                <li><a href="https://github.com/redclayantony/redclayantony.github.io" role="tab" target="_blank"><i class="fa fa-github"></i></a></li>
            </ul>

            <ul role="tablist">
                <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    Select A Region
                    <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
                </h1>
				<p class="lorem"><a onclick="gotocountry('mp')"> Machu Picchu</a></p>
				<p class="lorem"><a onclick="gotocountry('sk')"> Salkantay</a></p>
                <p class="lorem"><a onclick="gotocountry('lr')"> Lares</a></p>
                <p class="lorem"><a onclick="gotocountry('cc')"> Cusco City</a></p>
                <p class="lorem"><a onclick="gotocountry('az')"> Ausangate</a></p>
				<p class="lorem"><a onclick="gotocountry('cq')"> Choquequirao</a></p>
            </div>

            <div class="sidebar-pane" id="profile">
                <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

            <div class="sidebar-pane" id="messages">
                <h1 class="sidebar-header">Messages<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>
        </div>
   </div>
<div id="map"></div>
    <script>
        L.mapbox.accessToken = 'pk.eyJ1IjoicnVzc2x5b244IiwiYSI6IjBSaDVoeW8ifQ.UMzpeudvSJ3dHxAtKiakFg';
        var map = L.mapbox.map('map', null, {
			maxZoom:18,
			zoomControl: false}).setView([-13.163, -72.545], 15);
        var layers = {
            Streets: L.mapbox.tileLayer('mapbox.streets'),
            Outdoors: L.mapbox.styleLayer('mapbox://styles/russlyon8/ciwjh10yq000d2qo73t44eva0'),
            Satellite: L.mapbox.styleLayer('mapbox://styles/russlyon8/cioowi3rs001rbnnnsmkskehw')
        };

        layers.Outdoors.addTo(map);
        L.control.layers(layers).addTo(map);
        //add zoom control with your options
		L.control.zoom({
     		position:'topright'
		}).addTo(map);
        // Set CartoDB Username
        var cartoUserName = "redclayantony";
        
        // Add archaeologicalsites geojson from Carto
        var archSite = null;

        // sql query call on archaeological sites
        var sqlQueryArch = "SELECT * FROM archSiteMachu";

        // Set CartoDB Username
        var cartoUserName = "redclayantony";

        // remove archsites if already loaded
        function showAll(){
         if(map.hasLayer(archSiteMachu)){
           map.removeLayer(archSiteMachu);
        }}
  
         //archIcon style
        var archIcon = L.icon({
            iconUrl: 'icons/archIcon2.svg',
            iconSize: [28,28],
            iconAnchor: [5,5],
            popupanchor: [0,-3]
        });

        // Get CartoDB selection as GEOJSON and Add to Map
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryArch, function(data) {
            archSite = L.geoJson(data,{
                onEachFeature: function (feature, layer) {
                   layer.bindPopup(feature.properties.name);
                }, pointToLayer: function (feature, latlng) {
                    var marker = L.marker(latlng,{icon: archIcon});
                    return marker;
                }
            }).addTo(map);
        });

        // Add trailheadcusco.geojson
        var trailHead = null;
        
        // sql query on trailheads
        var sqlQueryTH = "SELECT * FROM trailheadscusco";

        // remove trailheads if already loaded
        function showAll(){
            if(map.hasLayer(trailheadscusco)){
                map.removeLayer(trailheadscusco);
            }}
  
       //archIcon
        var trailheadIcon = L.icon({
            iconUrl: 'icons/walker.svg',
            iconSize: [14,14],
            iconAnchor: [5,5],
            popupanchor: [0,-3]
        });

        // Get CartoDB selection as GEOJSON and Add to Map
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryTH, function(data) {
            trailHead = L.geoJson(data,{
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.name);
                }, pointToLayer: function (feature, latlng) {
                    var marker = L.marker(latlng,{icon: trailheadIcon});
                    return marker;
                }
            }).addTo(map);
        }); 
  
        // Add treksMachuGeo2.geojson
        var treksMachu = null;
            
        //event listener for mouseover   
        function highlightFeature(e) {
            var layer = e.target;

                layer.setStyle({
                    weight: 8,
                    color: '#7D26CD',
                    dashArray: ''
                });

            if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                layer.bringToFront();
            }
            info.update(layer.feature.properties);
            }

        function resetHighlight(e) {
            treksMachu.resetStyle(e.target);
            info.update();
        }

        //click listen zooms to feature
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        // sql query on treksmachgeo2
        var sqlQueryInca = "SELECT * FROM treksmachugeo2";

        //machuTrek line style
        var trekStyle = {
            color: "#aa6e8e",
            weight: 3,
            opacity: 1,
            dashArray: "5"
        };

        // remove treksMachu if preloaded
        function showAll(){
            if(map.hasLayer(treksmachugeo2)){
                map.removeLayer(treksmachugeo2);
            }
        }
        // add listeners to treksmachu
        function onEachFeature(feature, layer){
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }
 
        // load treksmachu from carto and assign oneachfeature
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryInca, function(data) {
            treksMachu = L.geoJson(data,{
                style: trekStyle,
                onEachFeature: onEachFeature
            }).addTo(map);
        });

        // Add sanctuarymp.geojson
        var sanctMachu = null;

        // sql query for machupicchu santuary
        var sqlQueryMachu = "SELECT * FROM sanctuarymp";

        //sanctMP style
        var sanctStyle = {
            color: "#659D32",
            fill: false,
            weight: 3,
            opacity: 0.7,
            dashArray: "1"
        };

        // remove if preloaded
        function showAll(){
            if(map.hasLayer(sanctuarymp)){
                map.removeLayer(sanctuarymp);
            }
        }
        // Get CartoDB selection as GEOJSON and Add to Map
        $.getJSON("https://"+cartoUserName+".carto.com/api/v2/sql?format=GeoJSON&q="+sqlQueryMachu, function(data) {
            sanctMachu = L.geoJson(data,{
                style: sanctStyle,
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.label);
                    layer.cartodb_id=feature.properties.cartodb_id;
                }
            }).addTo(map);
        });
 
        // Custom Control Box  
        var info = L.control();

        info.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
            this.update();
            return this._div;
        };

        // method that we will use to update the control based on feature properties passed
        info.update = function (props) {
            this._div.innerHTML = '<h3>Trek Details: </h3>' +  (props ?
                '<b>' + props.label + '</b><br /><br />' +"Approx "+ props.length_mi + ' miles</sup>'
            : '(Hover to see details)');
        };

        info.addTo(map);
  
        //Run showAll function when doc loads
        $( document ).ready(function() {
            showAll();
        });
		var sidebar = L.control.sidebar('sidebar').addTo(map);
		var gotocountry = function(c){
        // set new view 
         if(c=='mp')
         map.setView(new L.LatLng(-13.163, -72.545), 15);
	     if(c=='az')
         map.setView(new L.LatLng(-13.79, -71.23), 12);
         if(c=='sk')
         map.setView(new L.LatLng(-13.35, -72.55), 11.5);
		 if(c=='lr')
         map.setView(new L.LatLng(-13.22, -72.0), 13);
		 if(c=='cc')
         map.setView(new L.LatLng(-13.53, -71.97), 14);
		 if(c=='cq')
         map.setView(new L.LatLng(-13.425, -72.89), 13);
         return;
        
        
      };
    </script>
</body>
</html>